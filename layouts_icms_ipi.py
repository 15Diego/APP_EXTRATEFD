"""
Layouts para EFD ICMS/IPI (SPED Fiscal).

Define registros, campos e hierarquias de consolidação.
"""

from typing import Dict, List, Tuple

# =========================
# LAYOUTS DOS REGISTROS
# =========================

LAYOUTS_ICMS_IPI = {
    # --- Bloco 0: Abertura e Identificação ---
    '0000': ['REG', 'COD_VER', 'COD_FIN', 'DT_INI', 'DT_FIN', 'NOME', 'CNPJ', 'CPF', 'UF', 'IE', 'COD_MUN', 'IM', 'SUFRAMA', 'IND_PERFIL', 'IND_ATIV'],
    '0001': ['REG', 'IND_MOV'],
    '0005': ['REG', 'FANTASIA', 'CEP', 'END', 'NUM', 'COMPL', 'BAIRRO', 'FONE', 'FAX', 'EMAIL'],
    '0015': ['REG', 'UF_ST', 'IE_ST'],
    '0100': ['REG', 'NOME', 'CPF', 'CRC', 'CNPJ', 'CEP', 'END', 'NUM', 'COMPL', 'BAIRRO', 'FONE', 'FAX', 'EMAIL', 'COD_MUN'],
    '0150': ['REG', 'COD_PART', 'NOME', 'COD_PAIS', 'CNPJ', 'CPF', 'IE', 'COD_MUN', 'SUFRAMA', 'END', 'NUM', 'COMPL', 'BAIRRO'],
    '0175': ['REG', 'DT_ALT', 'NR_CAMPO', 'CONT_ANT'],
    '0190': ['REG', 'UNID', 'DESCR'],
    '0200': ['REG', 'COD_ITEM', 'DESCR_ITEM', 'COD_BARRA', 'COD_ANT_ITEM', 'UNID_INV', 'TIPO_ITEM', 'COD_NCM', 'EX_IPI', 'COD_GEN', 'COD_LST', 'ALIQ_ICMS', 'CEST'],
    '0205': ['REG', 'DESCR_ANT_ITEM', 'DT_INI', 'DT_FIN', 'COD_ANT_ITEM'],
    '0206': ['REG', 'COD_COMB'],
    '0210': ['REG', 'COD_ITEM_COMP', 'QTD_COMP', 'PERDA'],
    '0220': ['REG', 'UNID_CONV', 'FAT_CONV', 'COD_BARRA'],
    '0221': ['REG', 'COD_ITEM', 'DT_INI', 'DT_FIN'],
    '0300': ['REG', 'COD_IND_BEM', 'IDENT_MERC', 'DESCR_ITEM', 'COD_PRNC', 'COD_CTA', 'NR_PARC'],
    '0305': ['REG', 'COD_CCUS', 'FUNC', 'VIDA_UTIL'],
    '0400': ['REG', 'COD_NAT', 'DESCR_NAT'],
    '0450': ['REG', 'COD_INF', 'TXT'],
    '0460': ['REG', 'COD_OBS', 'TXT'],
    '0500': ['REG', 'DT_ALT', 'COD_NAT_CC', 'IND_CTA', 'NIVEL', 'COD_CTA', 'NOME_CTA'],
    '0600': ['REG', 'DT_ALT', 'COD_CCUS', 'CCUS'],
    '0990': ['REG', 'QTD_LIN_0'],

    # --- Bloco C: Documentos Fiscais I ---
    'C001': ['REG', 'IND_MOV'],
    'C100': ['REG', 'IND_OPER', 'IND_EMIT', 'COD_PART', 'COD_MOD', 'COD_SIT', 'SER', 'NUM_DOC', 'CHV_NFE', 'DT_DOC', 'DT_E_S', 'VL_DOC', 'IND_PGTO', 'VL_DESC', 'VL_ABAT_NT', 'VL_MERC', 'IND_FRT', 'VL_FRT', 'VL_SEG', 'VL_OUT_DA', 'VL_BC_ICMS', 'VL_ICMS', 'VL_BC_ICMS_ST', 'VL_ICMS_ST', 'VL_IPI', 'VL_PIS', 'VL_COFINS', 'VL_PIS_ST', 'VL_COFINS_ST'],
    'C101': ['REG', 'VL_FCP_UF_DEST', 'VL_ICMS_UF_DEST', 'VL_ICMS_UF_REM'],
    'C105': ['REG', 'OPER', 'UF'],
    'C110': ['REG', 'COD_INF', 'TXT_COMPL'],
    'C111': ['REG', 'NUM_PROC', 'IND_PROC'],
    'C112': ['REG', 'COD_DA', 'UF', 'NUM_DA', 'COD_AUT', 'VL_DA', 'DT_VCTO', 'DT_PGTO'],
    'C113': ['REG', 'IND_OPER', 'IND_EMIT', 'COD_PART', 'COD_MOD', 'SER', 'SUB', 'NUM_DOC', 'DT_DOC', 'CHV_DOCe'],
    'C114': ['REG', 'COD_MOD', 'ECF_FAB', 'ECF_CX', 'NUM_DOC', 'DT_DOC'],
    'C115': ['REG', 'IND_CARGA', 'CNPJ_COL', 'IE_COL', 'CPF_COL', 'COD_MUN_COL', 'CNPJ_ENTG', 'IE_ENTG', 'CPF_ENTG', 'COD_MUN_ENTG'],
    'C116': ['REG', 'COD_MOD', 'NR_SAT', 'CHV_CFE', 'NUM_CFE', 'DT_DOC'],
    'C120': ['REG', 'COD_DOC_IMP', 'NUM_DOC_IMP', 'PIS_IMP', 'COFINS_IMP', 'NUM_ACDRAW'],
    'C130': ['REG', 'VL_SERV_NT', 'VL_BC_ISSQN', 'VL_ISSQN', 'VL_BC_IRRF', 'VL_IRRF', 'VL_BC_PREV', 'VL_PREV'],
    'C140': ['REG', 'IND_EMIT', 'IND_TIT', 'DESC_TIT', 'NUM_TIT', 'QTD_PARC', 'VL_TIT'],
    'C141': ['REG', 'NUM_PARC', 'DT_VCTO', 'VL_PARC'],
    'C160': ['REG', 'COD_PART', 'VEIC_ID', 'QTD_VOL', 'PESO_BRT', 'PESO_LIQ', 'UF_ID'],
    'C165': ['REG', 'COD_PART', 'VEIC_ID', 'COD_AUT', 'NR_PASSE', 'HORA', 'TEMPER', 'QTD_VOL', 'PESO_BRT', 'PESO_LIQ', 'NOM_MOT', 'CPF', 'UF_ID'],
    'C170': ['REG', 'NUM_ITEM', 'COD_ITEM', 'DESCR_COMPL', 'QTD', 'UNID', 'VL_ITEM', 'VL_DESC', 'IND_MOV', 'CST_ICMS', 'CFOP', 'COD_NAT', 'VL_BC_ICMS', 'ALIQ_ICMS', 'VL_ICMS', 'VL_BC_ICMS_ST', 'ALIQ_ST', 'VL_ICMS_ST', 'IND_APUR', 'CST_IPI', 'COD_ENQ', 'VL_BC_IPI', 'ALIQ_IPI', 'VL_IPI', 'CST_PIS', 'VL_BC_PIS', 'ALIQ_PIS', 'QUANT_BC_PIS', 'ALIQ_PIS_QUANT', 'VL_PIS', 'CST_COFINS', 'VL_BC_COFINS', 'ALIQ_COFINS', 'QUANT_BC_COFINS', 'ALIQ_COFINS_QUANT', 'VL_COFINS', 'COD_CTA'],
    'C171': ['REG', 'NUM_TANQUE', 'QTDE'],
    'C172': ['REG', 'VL_BC_ISSQN', 'ALIQ_ISSQN', 'VL_ISSQN'],
    'C173': ['REG', 'LOTE_MED', 'QTD_ITEM', 'DT_FAB', 'DT_VAL', 'IND_MED', 'TP_PROD', 'VL_TAB_MAX'],
    'C174': ['REG', 'IND_ARM', 'NUM_ARM', 'DESCR_COMPL'],
    'C175': ['REG', 'IND_VEIC_OPER', 'CNPJ', 'UF', 'CHASSI_VEIC'],
    'C176': ['REG', 'COD_MOD_ULT_E', 'NUM_DOC_ULT_E', 'SER_ULT_E', 'DT_ULT_E', 'COD_PART_ULT_E', 'QUANT_ULT_E', 'VL_UNIT_ULT_E', 'VL_UNIT_BC_ST'],
    'C177': ['REG', 'COD_SELO_IPI', 'QT_SELO_IPI'],
    'C178': ['REG', 'CL_ENQ', 'VL_UNID', 'QUANT_PAD'],
    'C179': ['REG', 'BC_ST_ORIG_DEST', 'ICMS_ST_REP', 'ICMS_ST_COMPL', 'BC_RET', 'ICMS_RET'],
    'C180': ['REG', 'COD_RESP_RET', 'QUANT_CONV', 'UNID', 'VL_UNIT_CONV', 'VL_UNIT_ICMS_OP_CONV', 'VL_UNIT_BC_ICMS_ST_CONV', 'VL_UNIT_ICMS_ST_CONV', 'VL_UNIT_FCP_ST_CONV', 'COD_DA', 'NUM_DA'],
    'C181': ['REG', 'COD_MOT_REST_COMPL', 'QUANT_CONV', 'UNID', 'COD_MOD_SAIDA', 'SERIE_SAIDA', 'ECF_FAB_SAIDA', 'NUM_DOC_SAIDA', 'CHV_DFE_SAIDA', 'DT_DOC_SAIDA', 'NUM_ITEM_SAIDA', 'VL_UNIT_CONV_SAIDA', 'VL_UNIT_ICMS_OP_ESTOQUE', 'VL_UNIT_ICMS_ST_ESTOQUE', 'VL_UNIT_FCP_ICMS_ST_ESTOQUE', 'VL_UNIT_ICMS_OP_NA_SAIDA_CONV', 'VL_UNIT_ICMS_ST_CONV_REST', 'VL_UNIT_FCP_ST_CONV_REST'],
    'C185': ['REG', 'NUM_ITEM', 'COD_ITEM', 'CST_ICMS', 'CFOP', 'COD_MOT_REST_COMPL', 'QUANT_CONV', 'UNID', 'VL_UNIT_CONV', 'VL_UNIT_ICMS_NA_OPERACAO_CONV', 'VL_UNIT_ICMS_OP_CONV', 'VL_UNIT_ICMS_OP_ESTOQUE_CONV', 'VL_UNIT_ICMS_ST_ESTOQUE_CONV', 'VL_UNIT_FCP_ICMS_ST_ESTOQUE_CONV', 'VL_UNIT_ICMS_ST_CONV_REST', 'VL_UNIT_FCP_ST_CONV_REST', 'VL_UNIT_ICMS_ST_CONV_COMPL', 'VL_UNIT_FCP_ST_CONV_COMPL'],
    'C186': ['REG', 'NUM_ITEM', 'COD_ITEM', 'CST_ICMS', 'CFOP', 'COD_MOT_REST_COMPL', 'QUANT_CONV', 'UNID', 'COD_MOD_ENT', 'SERIE_ENT', 'NUM_DOC_ENT', 'CHV_DFE_ENT', 'DT_DOC_ENT', 'NUM_ITEM_ENT', 'VL_UNIT_CONV_ENT', 'VL_UNIT_ICMS_OP_CONV_ENT', 'VL_UNIT_BC_ICMS_ST_CONV_ENT', 'VL_UNIT_ICMS_ST_CONV_ENT', 'VL_UNIT_FCP_ST_CONV_ENT'],
    'C190': ['REG', 'CST_ICMS', 'CFOP', 'ALIQ_ICMS', 'VL_OPR', 'VL_BC_ICMS', 'VL_ICMS', 'VL_BC_ICMS_ST', 'VL_ICMS_ST', 'VL_RED_BC', 'VL_IPI', 'COD_OBS'],
    'C191': ['REG', 'VL_FCP_OP', 'VL_FCP_ST', 'VL_FCP_RET'],
    'C195': ['REG', 'COD_OBS', 'TXT_COMPL'],
    'C197': ['REG', 'COD_AJ', 'DESCR_COMPL_AJ', 'COD_ITEM', 'VL_BC_ICMS', 'ALIQ_ICMS', 'VL_ICMS', 'VL_OUTROS'],
    'C500': ['REG', 'IND_OPER', 'IND_EMIT', 'COD_PART', 'COD_MOD', 'COD_SIT', 'SER', 'SUB', 'COD_CONS', 'NUM_DOC', 'DT_DOC', 'DT_E_S', 'VL_DOC', 'VL_DESC', 'VL_FORN', 'VL_SERV_NT', 'VL_TERC', 'VL_DA', 'VL_BC_ICMS', 'VL_ICMS', 'VL_BC_ICMS_ST', 'VL_ICMS_ST', 'COD_INF', 'VL_PIS', 'VL_COFINS', 'TP_LIGACAO', 'COD_GRUPO_TENSAO', 'CHV_DOCe', 'FIN_DOCe', 'CHV_DOCe_REF', 'IND_DEST', 'COD_MUN_DEST', 'COD_CTA'],
    'C510': ['REG', 'NUM_ITEM', 'COD_ITEM', 'COD_CLASS', 'QTD', 'UNID', 'VL_ITEM', 'VL_DESC', 'CST_ICMS', 'CFOP', 'VL_BC_ICMS', 'ALIQ_ICMS', 'VL_ICMS', 'VL_BC_ICMS_ST', 'ALIQ_ST', 'VL_ICMS_ST', 'IND_REC', 'COD_PART', 'VL_PIS', 'VL_COFINS', 'COD_CTA'],
    'C590': ['REG', 'CST_ICMS', 'CFOP', 'ALIQ_ICMS', 'VL_OPR', 'VL_BC_ICMS', 'VL_ICMS', 'VL_BC_ICMS_ST', 'VL_ICMS_ST', 'VL_RED_BC', 'COD_OBS'],
    'C990': ['REG', 'QTD_LIN_C'],

    # --- Bloco D: Documentos Fiscais II ---
    'D001': ['REG', 'IND_MOV'],
    'D100': ['REG', 'IND_OPER', 'IND_EMIT', 'COD_PART', 'COD_MOD', 'COD_SIT', 'SER', 'SUB', 'NUM_DOC', 'CHV_CTE', 'DT_DOC', 'DT_A_P', 'TP_CT_E', 'CHV_CTE_REF', 'VL_DOC', 'VL_DESC', 'IND_FRT', 'VL_SERV', 'VL_BC_ICMS', 'VL_ICMS', 'VL_NT', 'COD_INF', 'COD_CTA', 'COD_MUN_ORIG', 'COD_MUN_DEST'],
    'D101': ['REG', 'VL_FCP_UF_DEST', 'VL_ICMS_UF_DEST', 'VL_ICMS_UF_REM'],
    'D110': ['REG', 'NUM_ITEM', 'COD_ITEM', 'VL_SERV', 'VL_OUT'],
    'D120': ['REG', 'COD_MUN_ORIG', 'COD_MUN_DEST', 'VEIC_ID', 'UF_ID'],
    'D130': ['REG', 'COD_PART_CONSG', 'COD_PART_RED', 'IND_FRT_RED', 'COD_MUN_ORIG', 'COD_MUN_DEST', 'VEIC_ID', 'VL_LIQ_FRT', 'VL_SEC_CAT', 'VL_DESP', 'VL_PEDG', 'VL_OUT', 'VL_FRT', 'UF_ID'],
    'D140': ['REG', 'COD_PART_CONSG', 'COD_MUN_ORIG', 'COD_MUN_DEST', 'IND_VEIC', 'VEIC_ID', 'IND_NAV', 'VIAGEM', 'VL_FRT_LIQ', 'VL_DESP_PORT', 'VL_DESP_CAR_DESC', 'VL_OUT', 'VL_FRT_BRT', 'VL_FRT_MM'],
    'D150': ['REG', 'COD_MUN_ORIG', 'COD_MUN_DEST', 'VEIC_ID', 'VIAGEM', 'IND_TFA', 'VL_PESO_TX', 'VL_TX_TERR', 'VL_TX_RED', 'VL_OUT', 'VL_TX_ADV'],
    'D160': ['REG', 'DESPACHO', 'CNPJ_CPF_REM', 'IE_REM', 'COD_MUN_ORI', 'CNPJ_CPF_DEST', 'IE_DEST', 'COD_MUN_DEST'],
    'D161': ['REG', 'IND_CARGA', 'CNPJ_CPF_COL', 'IE_COL', 'COD_MUN_COL', 'CNPJ_CPF_ENTG', 'IE_ENTG', 'COD_MUN_ENTG'],
    'D162': ['REG', 'COD_MOD', 'SER', 'NUM_DOC', 'DT_DOC', 'VL_DOC', 'VL_MERC', 'QTD_VOL', 'PESO_BRT', 'PESO_LIQ'],
    'D170': ['REG', 'COD_PART_CONSG', 'COD_PART_RED', 'COD_MUN_ORIG', 'COD_MUN_DEST', 'OTM', 'IND_NAT_FRT', 'VL_LIQ_FRT', 'VL_GRIS', 'VL_PDG', 'VL_OUT', 'VL_FRT', 'VEIC_ID', 'UF_ID'],
    'D180': ['REG', 'NUM_SEQ', 'IND_EMIT', 'CNPJ_CPF_EMIT', 'UF_EMIT', 'IE_EMIT', 'COD_MUN_ORIG', 'CNPJ_CPF_TOM', 'UF_TOM', 'IE_TOM', 'COD_MUN_DEST', 'COD_MOD', 'SER', 'SUB', 'NUM_DOC', 'DT_DOC', 'VL_DOC'],
    'D190': ['REG', 'CST_ICMS', 'CFOP', 'ALIQ_ICMS', 'VL_OPR', 'VL_BC_ICMS', 'VL_ICMS', 'VL_RED_BC', 'COD_OBS'],
    'D195': ['REG', 'COD_OBS', 'TXT_COMPL'],
    'D197': ['REG', 'COD_AJ', 'DESCR_COMPL_AJ', 'COD_ITEM', 'VL_BC_ICMS', 'ALIQ_ICMS', 'VL_ICMS', 'VL_OUTROS'],
    'D500': ['REG', 'IND_OPER', 'IND_EMIT', 'COD_PART', 'COD_MOD', 'COD_SIT', 'SER', 'SUB', 'NUM_DOC', 'DT_DOC', 'DT_A_P', 'VL_DOC', 'VL_DESC', 'VL_SERV', 'VL_SERV_NT', 'VL_TERC', 'VL_DA', 'VL_BC_ICMS', 'VL_ICMS', 'COD_INF', 'VL_PIS', 'VL_COFINS', 'COD_CTA', 'TP_ASSINANTE'],
    'D510': ['REG', 'NUM_ITEM', 'COD_ITEM', 'COD_CLASS', 'QTD', 'UNID', 'VL_ITEM', 'VL_DESC', 'CST_ICMS', 'CFOP', 'VL_BC_ICMS', 'ALIQ_ICMS', 'VL_ICMS', 'VL_BC_ICMS_ST', 'ALIQ_ST', 'VL_ICMS_ST', 'IND_REC', 'COD_PART', 'VL_PIS', 'VL_COFINS', 'COD_CTA'],
    'D530': ['REG', 'IND_SERV', 'DT_INI_SERV', 'DT_FIN_SERV', 'PER_FISCAL', 'COD_AREA', 'TERMINAL'],
    'D590': ['REG', 'CST_ICMS', 'CFOP', 'ALIQ_ICMS', 'VL_OPR', 'VL_BC_ICMS', 'VL_ICMS', 'VL_RED_BC', 'COD_OBS'],
    'D990': ['REG', 'QTD_LIN_D'],

    # --- Bloco E: Apuração ICMS/IPI ---
    'E001': ['REG', 'IND_MOV'],
    'E100': ['REG', 'DT_INI', 'DT_FIN'],
    'E110': ['REG', 'VL_TOT_DEBITOS', 'VL_AJ_DEBITOS', 'VL_TOT_AJ_DEBITOS', 'VL_ESTORNOS_CRED', 'VL_TOT_CREDITOS', 'VL_AJ_CREDITOS', 'VL_TOT_AJ_CREDITOS', 'VL_ESTORNOS_DEB', 'VL_SLD_CREDOR_ANT', 'VL_SLD_APURADO', 'VL_TOT_DED', 'VL_ICMS_RECOLHER', 'VL_SLD_CREDOR_TRANSPORTAR', 'DEB_ESP'],
    'E111': ['REG', 'COD_AJ_APUR', 'DESCR_COMPL_AJ', 'VL_AJ_APUR'],
    'E112': ['REG', 'NUM_DA', 'NUM_PROC', 'IND_PROC', 'PROC', 'TXT_COMPL'],
    'E113': ['REG', 'COD_PART', 'COD_MOD', 'SER', 'SUB', 'NUM_DOC', 'DT_DOC', 'COD_ITEM', 'VL_AJ_ITEM', 'CHV_DOCe'],
    'E115': ['REG', 'COD_INF_ADIC', 'VL_INF_ADIC', 'DESCR_COMPL_AJ'],
    'E116': ['REG', 'COD_OR', 'VL_OR', 'DT_VCTO', 'COD_REC', 'NUM_PROC', 'IND_PROC', 'PROC', 'TXT_COMPL', 'MES_REF'],
    'E200': ['REG', 'UF', 'DT_INI', 'DT_FIN'],
    'E210': ['REG', 'IND_MOV_ST', 'VL_SLD_CRED_ANT_ST', 'VL_DEVOL_ST', 'VL_RESSARC_ST', 'VL_OUT_CRED_ST', 'VL_AJ_CREDITOS_ST', 'VL_RETENCAO_ST', 'VL_OUT_DEB_ST', 'VL_AJ_DEBITOS_ST', 'VL_SLD_DEV_ANT_ST', 'VL_DEDUCOES_ST', 'VL_ICMS_RECOL_ST', 'VL_SLD_CRED_ST_TRANSPORTAR', 'DEB_ESP_ST'],
    'E220': ['REG', 'COD_AJ_APUR', 'DESCR_COMPL_AJ', 'VL_AJ_APUR'],
    'E230': ['REG', 'NUM_DA', 'NUM_PROC', 'IND_PROC', 'PROC', 'TXT_COMPL'],
    'E240': ['REG', 'COD_PART', 'COD_MOD', 'SER', 'SUB', 'NUM_DOC', 'DT_DOC', 'COD_ITEM', 'VL_AJ_ITEM', 'CHV_DOCe'],
    'E250': ['REG', 'COD_OR', 'VL_OR', 'DT_VCTO', 'COD_REC', 'NUM_PROC', 'IND_PROC', 'PROC', 'TXT_COMPL', 'MES_REF'],
    'E300': ['REG', 'UF', 'DT_INI', 'DT_FIN'],
    'E310': ['REG', 'IND_MOV_DIFAL', 'VL_SLD_CRED_ANT_DIFAL', 'VL_TOT_DEBITOS_DIFAL', 'VL_OUT_DEB_DIFAL', 'VL_TOT_CREDITOS_DIFAL', 'VL_OUT_CRED_DIFAL', 'VL_SLD_DEV_ANT_DIFAL', 'VL_DEDUCOES_DIFAL', 'VL_ICMS_RECOLHER_DIFAL', 'VL_SLD_CRED_TRANSPORTAR_DIFAL', 'DEB_ESP_DIFAL'],
    'E311': ['REG', 'COD_AJ_APUR', 'DESCR_COMPL_AJ', 'VL_AJ_APUR'],
    'E312': ['REG', 'NUM_DA', 'NUM_PROC', 'IND_PROC', 'PROC', 'TXT_COMPL'],
    'E313': ['REG', 'COD_PART', 'COD_MOD', 'SER', 'SUB', 'NUM_DOC', 'DT_DOC', 'COD_ITEM', 'VL_AJ_ITEM', 'CHV_DOCe'],
    'E316': ['REG', 'COD_OR', 'VL_OR', 'DT_VCTO', 'COD_REC', 'NUM_PROC', 'IND_PROC', 'PROC', 'TXT_COMPL', 'MES_REF'],
    'E500': ['REG', 'IND_APUR', 'DT_INI', 'DT_FIN'],
    'E510': ['REG', 'CFOP', 'CST_IPI', 'VL_CONT_IPI', 'VL_BC_IPI', 'VL_IPI'],
    'E520': ['REG', 'VL_SD_ANT_IPI', 'VL_DEB_IPI', 'VL_CRED_IPI', 'VL_OD_IPI', 'VL_OC_IPI', 'VL_SC_IPI', 'VL_SD_IPI'],
    'E530': ['REG', 'IND_AJ', 'VL_AJ', 'COD_AJ', 'IND_DOC', 'NUM_DOC', 'DESCR_AJ'],
    'E990': ['REG', 'QTD_LIN_E'],

    # --- Bloco H: Inventário Físico ---
    'H001': ['REG', 'IND_MOV'],
    'H005': ['REG', 'DT_INV', 'VL_INV', 'MOT_INV'],
    'H010': ['REG', 'COD_ITEM', 'UNID', 'QTD', 'VL_UNIT', 'VL_ITEM', 'IND_PROP', 'COD_PART', 'TXT_COMPL', 'COD_CTA', 'VL_ITEM_IR'],
    'H020': ['REG', 'CST_ICMS', 'BC_ICMS', 'VL_ICMS'],
    'H030': ['REG', 'VL_ICMS_OP', 'VL_BC_ICMS_ST', 'VL_ICMS_ST', 'VL_FCP'],
    'H990': ['REG', 'QTD_LIN_H'],

    # --- Bloco K: Produção e Estoque ---
    'K001': ['REG', 'IND_MOV'],
    'K010': ['REG', 'IND_TP_LEIAUTE'],
    'K100': ['REG', 'DT_INI', 'DT_FIN'],
    'K200': ['REG', 'DT_EST', 'COD_ITEM', 'QTD', 'IND_EST'],
    'K210': ['REG', 'DT_INI_OS', 'DT_FIN_OS', 'COD_DOC_OS', 'COD_ITEM_ORI', 'QTD_ORI'],
    'K215': ['REG', 'COD_ITEM_DES', 'QTD_DES'],
    'K220': ['REG', 'DT_MOV', 'COD_ITEM_ORI', 'COD_ITEM_DEST', 'QTD', 'QTD_DEST'],
    'K230': ['REG', 'DT_INI_OP', 'DT_FIN_OP', 'COD_DOC_OP', 'COD_ITEM', 'QTD_ENC'],
    'K235': ['REG', 'DT_SAIDA', 'COD_ITEM', 'QTD', 'COD_INS_SUBST'],
    'K250': ['REG', 'DT_PROD', 'COD_ITEM', 'QTD'],
    'K255': ['REG', 'DT_CONS', 'COD_ITEM', 'QTD', 'COD_INS_SUBST'],
    'K260': ['REG', 'COD_OP_OS', 'COD_ITEM', 'DT_SAIDA', 'QTD_SAIDA', 'DT_RET', 'QTD_RET'],
    'K265': ['REG', 'COD_ITEM', 'QTD_CONS', 'QTD_RET'],
    'K270': ['REG', 'DT_INI_AP', 'DT_FIN_AP', 'COD_OP_OS', 'COD_ITEM', 'QTD_COR_POS', 'QTD_COR_NEG', 'ORIGEM'],
    'K275': ['REG', 'COD_ITEM', 'QTD_COR_POS', 'QTD_COR_NEG', 'ORIGEM'],
    'K280': ['REG', 'DT_EST', 'COD_ITEM', 'QTD_COR_POS', 'QTD_COR_NEG', 'IND_EST', 'COD_PART'],
    'K290': ['REG', 'DT_INI_OP', 'DT_FIN_OP', 'COD_DOC_OP', 'ORIGEM'],
    'K291': ['REG', 'COD_ITEM', 'QTD'],
    'K292': ['REG', 'COD_ITEM', 'QTD'],
    'K300': ['REG', 'DT_PROD', 'ORIGEM'],
    'K301': ['REG', 'COD_ITEM', 'QTD'],
    'K302': ['REG', 'COD_ITEM', 'QTD'],
    'K990': ['REG', 'QTD_LIN_K'],

    # --- Bloco G: CIAP ---
    'G001': ['REG', 'IND_MOV'],
    'G110': ['REG', 'DT_INI', 'DT_FIN', 'SALDO_IN_ICMS', 'SOM_PARC', 'VL_TRIB_EXP', 'VL_TOTAL', 'IND_PER_SAI', 'ICMS_APROP', 'SOM_ICMS_OC'],
    'G125': ['REG', 'COD_IND_BEM', 'DT_MOV', 'TIPO_MOV', 'VL_IMOB_ICMS_OP', 'VL_IMOB_ICMS_ST', 'VL_IMOB_ICMS_FRT', 'VL_IMOB_ICMS_DIF', 'NUM_PARC', 'VL_PARC_PASS'],
    'G126': ['REG', 'DT_INI', 'DT_FIN', 'NUM_PARC', 'VL_PARC_PASS', 'VL_TRIB_OC', 'VL_TOTAL', 'IND_PER_SAI', 'VL_PARC_APROP'],
    'G130': ['REG', 'IND_EMIT', 'COD_PART', 'COD_MOD', 'SERIE', 'NUM_DOC', 'CHV_NFE_CTE', 'DT_DOC', 'NUM_DA'],
    'G140': ['REG', 'NUM_ITEM', 'COD_ITEM', 'QTDE', 'UNID', 'VL_ICMS_OP_APLIC', 'VL_ICMS_ST_APLIC', 'VL_ICMS_FRT_APLIC', 'VL_ICMS_DIF_APLIC'],
    'G990': ['REG', 'QTD_LIN_G'],

    # --- Bloco 1: Outras Informações ---
    '1001': ['REG', 'IND_MOV'],
    '1010': ['REG', 'IND_EXP', 'IND_CCRF', 'IND_COMB', 'IND_USINA', 'IND_VA', 'IND_EE', 'IND_CART', 'IND_FORM', 'IND_AER', 'IND_GIAF1', 'IND_GIAF3', 'IND_GIAF4', 'IND_REST_RESSARC_COMPL_ICMS'],
    '1100': ['REG', 'IND_DOC', 'NRO_DE', 'DT_DE', 'NAT_EXP', 'NRO_RE', 'DT_RE', 'CHC_EMB', 'DT_CHC', 'DT_AVB', 'TP_CHC', 'PAIS'],
    '1105': ['REG', 'COD_MOD', 'SERIE', 'NUM_DOC', 'CHV_NFE', 'DT_DOC', 'COD_ITEM'],
    '1110': ['REG', 'COD_PART', 'COD_MOD', 'SER', 'NUM_DOC', 'DT_DOC', 'CHV_NFE', 'NR_MEMO', 'QTD', 'UNID'],
    '1200': ['REG', 'COD_AJ_APUR', 'SLD_CRED', 'CRED_APR', 'CRED_RECEB', 'CRED_UTIL', 'SLD_CRED_FIM'],
    '1210': ['REG', 'TIPO_UTIL', 'NR_DOC', 'VL_CRED_UTIL', 'CHV_DOCe'],
    '1250': ['REG', 'VL_CREDITO_ICMS_OP', 'VL_ICMS_ST_REST', 'VL_FCP_ST_REST', 'VL_ICMS_ST_COMPL', 'VL_FCP_ST_COMPL'],
    '1255': ['REG', 'COD_MOT_REST_COMPL', 'VL_CREDITO_ICMS_OP_MOT', 'VL_ICMS_ST_REST_MOT', 'VL_FCP_ST_REST_MOT', 'VL_ICMS_ST_COMPL_MOT', 'VL_FCP_ST_COMPL_MOT'],
    '1300': ['REG', 'COD_ITEM', 'DT_FECH', 'ESTQ_ABERT', 'VOL_ENTR', 'VOL_DISP', 'VOL_SAIDAS', 'ESTQ_ESCR', 'VAL_AJ_PERDA', 'VAL_AJ_GANHO', 'FECH_FISICO'],
    '1310': ['REG', 'NUM_TANQUE', 'ESTQ_ABERT', 'VOL_ENTR', 'VOL_DISP', 'VOL_SAIDAS', 'ESTQ_ESCR', 'VAL_AJ_PERDA', 'VAL_AJ_GANHO', 'FECH_FISICO'],
    '1320': ['REG', 'NUM_BICO', 'NR_INTERV', 'MOT_INTERV', 'NOM_INTERV', 'CNPJ_INTERV', 'CPF_INTERV', 'VAL_FECHA', 'VAL_ABERT', 'VOL_AFERI', 'VOL_VENDAS'],
    '1350': ['REG', 'SERIE', 'FABRICANTE', 'MODELO', 'TIPO_MEDICAO'],
    '1360': ['REG', 'NUM_LACRE', 'DT_APLICACAO'],
    '1370': ['REG', 'NUM_BICO', 'COD_ITEM', 'NUM_TANQUE'],
    '1390': ['REG', 'COD_PROD'],
    '1391': ['REG', 'DT_REGISTRO', 'QTD_MOID', 'ESTQ_INI', 'QTD_PRODUZ', 'ENT_ANID_HID', 'OUTR_ENTR', 'PERDA', 'CONS', 'SAI_ANI_HID', 'SAIDAS', 'ESTQ_FIN', 'ESTQ_INI_MEL', 'PROD_DIA_MEL', 'UTIL_MEL', 'PROD_ALC_MEL', 'OBS'],
    '1400': ['REG', 'COD_ITEM_IPM', 'MUN', 'VALOR'],
    '1500': ['REG', 'IND_OPER', 'IND_EMIT', 'COD_PART', 'COD_MOD', 'COD_SIT', 'SER', 'SUB', 'COD_CONS', 'NUM_DOC', 'DT_DOC', 'DT_E_S', 'VL_DOC', 'VL_DESC', 'VL_FORN', 'VL_SERV_NT', 'VL_TERC', 'VL_DA', 'VL_BC_ICMS', 'VL_ICMS', 'VL_BC_ICMS_ST', 'VL_ICMS_ST', 'COD_INF', 'VL_PIS', 'VL_COFINS', 'TP_LIGACAO', 'COD_GRUPO_TENSAO'],
    '1510': ['REG', 'NUM_ITEM', 'COD_ITEM', 'COD_CLASS', 'QTD', 'UNID', 'VL_ITEM', 'VL_DESC', 'CST_ICMS', 'CFOP', 'VL_BC_ICMS', 'ALIQ_ICMS', 'VL_ICMS', 'VL_BC_ICMS_ST', 'ALIQ_ST', 'VL_ICMS_ST', 'IND_REC', 'COD_PART', 'VL_PIS', 'VL_COFINS', 'COD_CTA'],
    '1600': ['REG', 'COD_PART', 'TOT_CREDITO', 'TOT_DEBITO'],
    '1601': ['REG', 'COD_PART_IP', 'COD_PART_IT', 'TOT_VS', 'TOT_ISS', 'TOT_OUTROS'],
    '1700': ['REG', 'COD_DISP', 'COD_MOD', 'SER', 'SUB', 'NUM_DOC_INI', 'NUM_DOC_FIN', 'NUM_AUT'],
    '1710': ['REG', 'NUM_DOC_INI', 'NUM_DOC_FIN'],
    '1800': ['REG', 'VL_CARGA', 'VL_PASS', 'VL_FAT', 'IND_RAT', 'VL_ICMS_ANT', 'VL_BC_ICMS', 'VL_ICMS_APUR', 'VL_BC_ICMS_APUR', 'VL_DIF'],
    '1900': ['REG', 'IND_APUR_ICMS', 'DESCR_COMPL_OUT_APUR'],
    '1910': ['REG', 'DT_INI', 'DT_FIN'],
    '1920': ['REG', 'VL_TOT_TRANSF_DEBITOS_OA', 'VL_TOT_AJ_DEBITOS_OA', 'VL_ESTORNOS_CRED_OA', 'VL_TOT_TRANSF_CREDITOS_OA', 'VL_TOT_AJ_CREDITOS_OA', 'VL_ESTORNOS_DEB_OA', 'VL_SLD_CREDOR_ANT_OA', 'VL_SLD_APURADO_OA', 'VL_TOT_DED', 'VL_ICMS_RECOLHER_OA', 'VL_SLD_CREDOR_TRANSP_OA', 'DEB_ESP_OA'],
    '1921': ['REG', 'COD_AJ_APUR', 'DESCR_COMPL_AJ', 'VL_AJ_APUR'],
    '1922': ['REG', 'NUM_DA', 'NUM_PROC', 'IND_PROC', 'PROC', 'TXT_COMPL'],
    '1923': ['REG', 'COD_PART', 'COD_MOD', 'SER', 'SUB', 'NUM_DOC', 'DT_DOC', 'COD_ITEM', 'VL_AJ_ITEM', 'CHV_DOCe'],
    '1925': ['REG', 'COD_INF_ADIC', 'VL_INF_ADIC', 'DESCR_COMPL_AJ'],
    '1926': ['REG', 'COD_OR', 'VL_OR', 'DT_VCTO', 'COD_REC', 'NUM_PROC', 'IND_PROC', 'PROC', 'TXT_COMPL', 'MES_REF'],
    '1960': ['REG', 'IND_AP', 'G1_01', 'G1_02', 'G1_03', 'G1_04', 'G1_05', 'G1_06', 'G1_07', 'G1_08', 'G1_09', 'G1_10', 'G1_11'],
    '1970': ['REG', 'IND_AP', 'G4_01', 'G4_02', 'G4_03', 'G4_04', 'G4_05', 'G4_06', 'G4_07', 'G4_08', 'G4_09', 'G4_10', 'G4_11', 'G4_12'],
    '1975': ['REG', 'ALIQ_IMP_BASE', 'G5_01', 'G5_02', 'G5_03'],
    '1980': ['REG', 'IND_AP', 'G6_01', 'G6_02', 'G6_03', 'G6_04', 'G6_05'],
    '1990': ['REG', 'QTD_LIN_1'],

    # --- Bloco 9: Encerramento ---
    '9001': ['REG', 'IND_MOV'],
    '9900': ['REG', 'REG_BLC', 'QTD_REG_BLC'],
    '9990': ['REG', 'QTD_LIN_9'],
    '9999': ['REG', 'QTD_LIN'],
}

# Campos numéricos por registro
NUMERIC_COLUMNS_ICMS_IPI = {
    'C100': ['VL_DOC', 'VL_DESC', 'VL_ABAT_NT', 'VL_MERC', 'VL_FRT', 'VL_SEG', 'VL_OUT_DA', 'VL_BC_ICMS', 'VL_ICMS', 'VL_BC_ICMS_ST', 'VL_ICMS_ST', 'VL_IPI', 'VL_PIS', 'VL_COFINS', 'VL_PIS_ST', 'VL_COFINS_ST'],
    'C170': ['QTD', 'VL_ITEM', 'VL_DESC', 'VL_BC_ICMS', 'ALIQ_ICMS', 'VL_ICMS', 'VL_BC_ICMS_ST', 'ALIQ_ST', 'VL_ICMS_ST', 'VL_BC_IPI', 'ALIQ_IPI', 'VL_IPI', 'VL_BC_PIS', 'ALIQ_PIS', 'VL_PIS', 'VL_BC_COFINS', 'ALIQ_COFINS', 'VL_COFINS'],
    'C190': ['ALIQ_ICMS', 'VL_OPR', 'VL_BC_ICMS', 'VL_ICMS', 'VL_BC_ICMS_ST', 'VL_ICMS_ST', 'VL_RED_BC', 'VL_IPI'],
    'C197': ['VL_BC_ICMS', 'ALIQ_ICMS', 'VL_ICMS', 'VL_OUTROS'],
    'C500': ['VL_DOC', 'VL_DESC', 'VL_FORN', 'VL_SERV_NT', 'VL_TERC', 'VL_DA', 'VL_BC_ICMS', 'VL_ICMS', 'VL_BC_ICMS_ST', 'VL_ICMS_ST', 'VL_PIS', 'VL_COFINS'],
    'C590': ['ALIQ_ICMS', 'VL_OPR', 'VL_BC_ICMS', 'VL_ICMS', 'VL_BC_ICMS_ST', 'VL_ICMS_ST', 'VL_RED_BC'],
    'D100': ['VL_DOC', 'VL_DESC', 'VL_SERV', 'VL_BC_ICMS', 'VL_ICMS', 'VL_NT'],
    'D190': ['ALIQ_ICMS', 'VL_OPR', 'VL_BC_ICMS', 'VL_ICMS', 'VL_RED_BC'],
    'D197': ['VL_BC_ICMS', 'ALIQ_ICMS', 'VL_ICMS', 'VL_OUTROS'],
    'D500': ['VL_DOC', 'VL_DESC', 'VL_SERV', 'VL_SERV_NT', 'VL_TERC', 'VL_DA', 'VL_BC_ICMS', 'VL_ICMS', 'VL_PIS', 'VL_COFINS'],
    'D590': ['ALIQ_ICMS', 'VL_OPR', 'VL_BC_ICMS', 'VL_ICMS', 'VL_RED_BC'],
    'E110': ['VL_TOT_DEBITOS', 'VL_AJ_DEBITOS', 'VL_TOT_AJ_DEBITOS', 'VL_ESTORNOS_CRED', 'VL_TOT_CREDITOS', 'VL_AJ_CREDITOS', 'VL_TOT_AJ_CREDITOS', 'VL_ESTORNOS_DEB', 'VL_SLD_CREDOR_ANT', 'VL_SLD_APURADO', 'VL_TOT_DED', 'VL_ICMS_RECOLHER', 'VL_SLD_CREDOR_TRANSPORTAR', 'DEB_ESP'],
    'E111': ['VL_AJ_APUR'],
    'E113': ['VL_AJ_ITEM'],
    'E115': ['VL_INF_ADIC'],
    'E116': ['VL_OR'],
    'E210': ['VL_SLD_CRED_ANT_ST', 'VL_DEVOL_ST', 'VL_RESSARC_ST', 'VL_OUT_CRED_ST', 'VL_AJ_CREDITOS_ST', 'VL_RETENCAO_ST', 'VL_OUT_DEB_ST', 'VL_AJ_DEBITOS_ST', 'VL_SLD_DEV_ANT_ST', 'VL_DEDUCOES_ST', 'VL_ICMS_RECOL_ST', 'VL_SLD_CRED_ST_TRANSPORTAR', 'DEB_ESP_ST'],
    'E520': ['VL_SD_ANT_IPI', 'VL_DEB_IPI', 'VL_CRED_IPI', 'VL_OD_IPI', 'VL_OC_IPI', 'VL_SC_IPI', 'VL_SD_IPI'],
    'H005': ['VL_INV'],
    'H010': ['QTD', 'VL_UNIT', 'VL_ITEM', 'VL_ITEM_IR'],
    'H020': ['BC_ICMS', 'VL_ICMS'],
    'K200': ['QTD'],
    'K230': ['QTD_ENC'],
    'K235': ['QTD'],
    'K250': ['QTD'],
    'K255': ['QTD'],
}

# Hierarquia de consolidação (pai -> filhos)
GROUPS_ICMS_IPI = {
    'C': ('C100', ['C101', 'C105', 'C110', 'C111', 'C112', 'C113', 'C114', 'C115', 'C116', 'C120', 'C130', 'C140', 'C141', 'C160', 'C165', 'C170', 'C171', 'C172', 'C173', 'C174', 'C175', 'C176', 'C177', 'C178', 'C179', 'C180', 'C181', 'C185', 'C186', 'C190', 'C191', 'C195', 'C197'], 'C100_INDEX', 'C001_INDEX', 'C001'),
    'C500': ('C500', ['C510', 'C590'], 'C500_INDEX', 'C001_INDEX', 'C001'),
    'D': ('D100', ['D101', 'D110', 'D120', 'D130', 'D140', 'D150', 'D160', 'D161', 'D162', 'D170', 'D180', 'D190', 'D195', 'D197'], 'D100_INDEX', 'D001_INDEX', 'D001'),
    'D500': ('D500', ['D510', 'D530', 'D590'], 'D500_INDEX', 'D001_INDEX', 'D001'),
    'E': ('E110', ['E111', 'E112', 'E113', 'E115', 'E116'], 'E110_INDEX', 'E100_INDEX', 'E100'),
    'E_ST': ('E210', ['E220', 'E230', 'E240', 'E250'], 'E210_INDEX', 'E200_INDEX', 'E200'),
    'E_DIFAL': ('E310', ['E311', 'E312', 'E313', 'E316'], 'E310_INDEX', 'E300_INDEX', 'E300'),
    'E_IPI': ('E520', ['E530'], 'E520_INDEX', 'E500_INDEX', 'E500'),
    'G': ('G110', ['G125', 'G126', 'G130', 'G140'], 'G110_INDEX', 'G001_INDEX', 'G001'),
    'H': ('H005', ['H010', 'H020', 'H030'], 'H005_INDEX', 'H001_INDEX', 'H001'),
    'K': ('K100', ['K200', 'K210', 'K215', 'K220', 'K230', 'K235', 'K250', 'K255', 'K260', 'K265', 'K270', 'K275', 'K280', 'K290', 'K291', 'K292', 'K300', 'K301', 'K302'], 'K100_INDEX', 'K001_INDEX', 'K001'),
}

# Tipo de EFD
EFD_TYPE = 'ICMS_IPI'
EFD_DESCRIPTION = 'EFD ICMS/IPI (SPED Fiscal)'
